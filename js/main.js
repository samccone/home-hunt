(function(){window.App=new Backbone.Marionette.Application}).call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};window.Router=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments),a}return c(d,b),d.prototype.appRoutes={"":"home"},d}(Backbone.Marionette.AppRouter)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};window.Controller=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments),a}return c(d,b),d.prototype.home=function(){return App.LoadingRegion.show(new App.Views.Locating)},d}(Marionette.Controller)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};App.module("Models",function(a,c,d,e,f,g){var h;return a.Home=function(a){function c(){return h=c.__super__.constructor.apply(this,arguments),h}return b(c,a),c.prototype.getBed=function(){return this.attributes[7][1]},c.prototype.getBath=function(){return this.attributes[7][2]},c.prototype.getSqFt=function(){return this.attributes[7][3]},c.prototype.shouldShow=function(){return this.attributes[7][5]!=null&&this.getSqFt()!=null},c.prototype.getImage=function(){return this.attributes[7][5].replace("p_a","p_d")},c.prototype.getCost=function(){return this.attributes[3]},c}(d.Model)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};App.module("Collections",function(a,c,d,e,f,g){var h;return a.Homes=function(a){function d(){return h=d.__super__.constructor.apply(this,arguments),h}return b(d,a),d.prototype.model=c.Models.Home,d}(d.Collection)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};App.module("Views",function(a,c,d,e,f,g){var h;return a.EnergyTrends=function(a){function d(){return h=d.__super__.constructor.apply(this,arguments),h}return b(d,a),d.prototype.template=templates.energy_trends,d.prototype.events=function(){return{"click li":this.toggleChartLine}},d.prototype.toggleChartLine=function(a){var b,c;return b=f(a.currentTarget),c=null,g.each(this.chartData,function(a,d){if(~a.id.indexOf(b.data("id")))return c=d}),f("[class*='"+b.data("id")+"']").toggle(),this.chart.redrawLine(c),b.toggleClass("disabled")},d.prototype.onShow=function(){var a=this;return c.Utils.API.getTrends().then(function(b){var d;return d=g.map(b,function(a){return{id:a.series[0].series_id,data:g.map(a.series[0].data,function(a){return parseFloat(a[1])}).reverse()}}),a.chartData=d,a.chart=new c.Utils.LineChart(d)})},d}(e.ItemView)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};App.module("Views",function(a,c,d,e,f,g){var h;return a.Grid=function(d){function e(){return h=e.__super__.constructor.apply(this,arguments),h}return b(e,d),e.prototype.template=templates.grid_layout,e.prototype.regions={homes:".homes",energyTrends:".energy-trends"},e.prototype.initialize=function(){var a,b=this;return this.homeList=new c.Collections.Homes([]),this.demograpics=null,a=f.when(c.Utils.API.getDemographics(),c.Utils.API.getHomes()),a.then(function(a,c){var d;return d=a[0]["Demographics:demographics"].response[0].pages[0].page[2].tables[0].table[0].data[0].attribute,b.commuteTime=d[6].values[0].nation[0].value[0],b.familySize=d[5].values[0].nation[0].value[0],b.homesBuildBefore1900=a[0]["Demographics:demographics"].response[0].pages[0].page[1].tables[0].table[1].data[0].attribute[0].value[0]._,b.homes.currentView.setDemographics(b.commuteTime,b.familySize,b.homesBuildBefore1900),b.homeList.reset(c[0].map.properties)})},e.prototype.onShow=function(){return this.homes.show(new a.HomeGrid({collection:this.homeList})),this.energyTrends.show(new a.EnergyTrends)},e}(e.Layout)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};App.module("Views",function(a,c,d,e,f,g){var h;return a.HomeGrid=function(c){function d(){return h=d.__super__.constructor.apply(this,arguments),h}return b(d,c),d.prototype.tagName="ul",d.prototype.getItemView=function(){return a.HomeGridItem},d.prototype.addItemView=function(a,b,c){c===3&&this.elBuffer.appendChild(f(templates.commute_time({time:this.commuteTime}))[0]),c===7&&(this.elBuffer.appendChild(f(templates.energy_fact())[0]),this.elBuffer.appendChild(f(templates.family_size({size:parseFloat(this.familySize)}))[0])),c===8&&this.elBuffer.appendChild(f(templates.old_homes({percent:this.homesBuildBefore1900}))[0]);if(a.shouldShow())return d.__super__.addItemView.apply(this,arguments)},d.prototype.setDemographics=function(a,b,c){this.commuteTime=a,this.familySize=b,this.homesBuildBefore1900=c},d.prototype.onDomRefresh=function(){return this.$(".lazy").show().lazyload()},d}(e.CollectionView)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};App.module("Views",function(a,c,d,e,f,g){var h;return a.HomeGridItem=function(a){function c(){return h=c.__super__.constructor.apply(this,arguments),h}return b(c,a),c.prototype.template=templates.home_grid_item,c.prototype.className="tile third home",c.prototype.tagName="li",c.prototype.serializeData=function(){return g.extend(this.model.attributes,{homeSqFt:this.model.getSqFt(),homeBath:this.model.getBath(),homeBed:this.model.getBed(),homeImage:this.model.getImage(),homePrice:this.model.getCost()})},c.prototype.modelEvents=function(){return{"change:energyCost":function(){return this.render(),this.$(".lazy").lazyload()}}},c.prototype.onShow=function(){var a=this;return this.$("input").on("change",function(b){var c;return c=new FileReader,c.onload=function(b){var c,d,e;return e=f.xml2json(b.target.result).feed.entry.slice(4),d=e.length-1,c=g(e).map(function(a){var b;return parseInt((b=a.content.IntervalBlock)!=null?b.IntervalReading.cost:void 0,10)}).compact().reduce(function(a,b){return a+=b}).valueOf(),a.model.set("energyCost",(""+~~(c/d)).slice(0,3))},c.readAsText(arguments[0].originalEvent.target.files[0])})},c}(e.ItemView)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};App.module("Views",function(a,c,d,e,f,g){var h;return a.Locating=function(a){function d(){return h=d.__super__.constructor.apply(this,arguments),h}return b(d,a),d.prototype.template=templates.locating,d.prototype.onShow=function(){return this.getLocation()},d.prototype.getLocation=function(){return navigator.geolocation.getCurrentPosition(function(a){var b,d;return b=new google.maps.Geocoder,d=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),b.geocode({latLng:d},function(a){var b,d;return d=a[0].address_components[7].short_name,b=a[0].address_components[5].short_name,c.reqres.setHandler("zip",function(){return"02906"}),c.reqres.setHandler("state",function(){return"RI"}),c.LoadingRegion.reset(),c.AppRegion.show(new c.Views.Grid)})})},d}(e.Layout)})}.call(this),function(){App.module("Utils",function(a,b,c,d,e,f){var g;return g="http://house-hunt-api.nodejitsu.com/",a.API={getHomes:function(){return e.getJSON(""+g+"homes/"+b.request("zip")+"?callback=?")},getDemographics:function(){return e.getJSON(""+g+"demographics/"+b.request("zip")+"?callback=?")},getTrends:function(){return e.getJSON(""+g+"trends/"+b.request("state")+"?callback=?")}}})}.call(this),function(){App.module("Utils",function(a,b,c,d,e,f){var g,h,i,j,k,l;return j=22,k=22,h=400+j,l=750,i=10,g=4,a.LineChart=function(){function a(a){var b=this;this.data=a,this.chart=d3.select(".chart").attr("width",l).attr("height",h),this.y=d3.scale.linear().domain([0,d3.max(f.flatten(f.map(this.data,function(a){return a.data})))]).range([h-j,k]),this.x=d3.scale.linear().domain([0,this.data[0].data.length]).range([i,l-i]),this.line=d3.svg.line().interpolate("monotone").x(function(a,c){return b.x(c)}).y(this.y),this.data.forEach(function(a,c,d){return d==null&&(d=!0),b.drawLine.apply(b,arguments)}),this.drawAxis()}return a.prototype.drawAxis=function(){var a;return a=d3.svg.axis().scale(this.x).orient("bottom").tickFormat(function(a,b){return 1969+~~(44*b/8)}),this.chart.append("g").attr("transform",function(){return"translate(0, "+(h-j)+")"}).call(a)},a.prototype.drawLine=function(a,b,c){var d;return d=a.data.map(function(){return 0}),c?this.chart.append("svg:path").attr("d",this.line(d)).attr("class","line"+b+" id-"+a.id).transition().duration(500).attr("d",this.line(a.data)):(this.chart.selectAll("circle.line"+b).attr("cy",h-j),this.chart.select("path.line"+b).attr("d",this.line(d)).transition().duration(500).attr("d",this.line(a.data))),this.chart.selectAll("circle.line"+b).data(d).enter().append("circle").attr("class","line"+b+" id-"+a.id).attr("cx",this.line.x()).attr("cy",this.line.y()).attr("r",g),this.chart.selectAll("circle.line"+b).data(a.data).transition().duration(500).attr("cx",this.line.x()).attr("cy",this.line.y())},a.prototype.redrawLine=function(a){return this.drawLine(this.data[a],a,!1)},a}()})}.call(this),function(){App.on("initialize:after",function(){return App.addRegions({AppRegion:"#app",LoadingRegion:"#loading"}),App.Router=new Router({controller:new Controller}),Backbone.history.start({pushState:!0})}),$(function(){return App.start()})}.call(this)